# 龙贝格(Romberg)积分法

## 问题分析

### 实验要求

编写代码实现龙贝格(Romberg)积分法的算法，用计算机计算定积分积分的数值逼近。

### 算法背景

龙贝格(Romberg)积分法为数值积分算法的一种。数值积分即线性泛函
$$
I(f)=\int_a^bf(x)\mathrm{d}x,~~-\infty\leqslant a < b \leqslant +\infty
$$
的近似计算。

龙贝格积分法为复化梯形公式进行外推得到的。通过外推使得误差减小。由于每次计算为将区间对分一次，又称为数值积分逐次对分加速收敛法，通过对分加速其收敛。

### 算法特点

在计算中会得到一个 $T$ 数表，整个计算过程为自顶向下的，有动态规划的思想在其中。且每次对分都利用了之前的计算结果，避免了重复计算，在执行效率上有其优越性，并且易于编写程序实现。

### 待求解问题

用龙贝格积分法求函数 $f(x)$ 从 $a$ 到 $b$ 的积分，即 $\int^b_af(x)$ 的数值解。

## 数学原理

一般地，利用龙贝格积分法计算积分，我们需要计算如下 $T$ 数表：
$$
\begin{matrix}
T_{0,0} & T_{0,1} & T_{0,2} & \cdots \\
T_{1,0} & T_{1,1} & \cdots  &  ~ \\
T_{2,0} & \cdots  &  ~      &  ~ \\
\cdots  & ~       &  ~      &  ~ \\
\end{matrix}
$$

每次对分计算一个反斜对角线上的数，并且从上往下计算，最顶上的 $T$ 数为其左边的进行区间对分得到，往下的所有数都由其上两个数计算得到。
$$
T_{m,k}=\frac{4^mT_{m-1,k+1}-T_{m-1,k}}{4^m-1}
$$

## 程序设计流程

```python
def Romberg(
    a: float,
    b: float,
    epsilon: float,
    f: ufunc
) -> tuple[float, list[list[float]]]:
    """
    Arguments:
        a {float} -- 积分下限
        b {float} -- 积分上限
        epsilon {float} -- 精度要求
        f {ufunc} -- 被积函数
    Returns:
        tuple[float, list[list[float]]] -- (数值积分值, T 数表)
    """
    h = b - a
    i = 1
    Tlist = list()
    Tlist.append([h/2*(f(a)+f(b))])
    while True:
        ii = 2**(i-1)
        Tlist[0].append(Tlist[0][i-1]/2+h/2 *\
                        (sum([f(a+(k-1/2)*h) for k in range(1, ii+1)])))
        for m in range(1, i+1):
            if m == i:
                Tlist.append([])
            Tlist[m].append((4**m*Tlist[m-1][-1]-Tlist[m-1][-2])/(4**m-1))
        if abs(Tlist[i][0]-Tlist[i-1][0]) < epsilon:
            return (Tlist[i][0], Tlist)
        h /= 2
        i += 1
```

## 实验结果、结论与讨论

### 问题 1

#### （1）

$$
\int_0^1 x^2e^x dx,~~\epsilon=10^{-6}
$$

result = 0.718282，T 数表为：

$$
\begin{matrix}
 1.35914091 &  0.88566062 &  0.76059633 &  0.72889018 &  0.72093578 \\
 0.72783385 &  0.71890824 &  0.71832146 &  0.71828431 & ~\\
 0.71831320 &  0.71828234 &  0.71828184 & ~ & ~ \\
 0.71828185 &  0.71828183 & ~ & ~ & ~ \\
 0.71828183 & ~ & ~ & ~ & ~ \\
\end{matrix}
$$

#### （2）

$$
\int_1^3 e^x\sin x dx,~~\epsilon=10^{-6}
$$

result = 10.950170，T 数表为：

$$
\begin{matrix}
 5.12182642 &  9.27976291 & 10.52055428 & 10.84204347 & 10.92309389 & 10.94339842 \\
10.66574174 & 10.93415141 & 10.94920653 & 10.95011070 & 10.95016660 & ~ \\
10.95204539 & 10.95021020 & 10.95017097 & 10.95017033 & ~ & ~ \\
10.95018107 & 10.95017035 & 10.95017031 & ~ & ~ & ~ \\
10.95017031 & 10.95017031 & ~ & ~ & ~ & ~ \\
10.95017031 & ~ & ~ & ~ & ~ & ~ \\
\end{matrix}
$$

#### （3）

$$
\int_0^1 \frac{4}{1+x^2} dx,~~\epsilon=10^{-6}
$$

result = 3.141593，T 数表为：

$$
\begin{matrix}
 3.00000000 &  3.10000000 &  3.13117647 &  3.13898849 &  3.14094161 &  3.14142989 \\
 3.13333333 &  3.14156863 &  3.14159250 &  3.14159265 &  3.14159265 & ~ \\
 3.14211765 &  3.14159409 &  3.14159266 &  3.14159265 & ~ & ~ \\
 3.14158578 &  3.14159264 &  3.14159265 & ~ & ~ & ~ \\
 3.14159267 &  3.14159265 & ~ & ~ & ~ & ~ \\
 3.14159265 & ~ & ~ & ~ & ~ & ~ \\
\end{matrix}
$$

#### （4）

$$
\int_0^1 \frac{1}{x+1} dx,~~\epsilon=10^{-6}
$$

result = 0.693147，T 数表为：

$$
\begin{matrix}
 0.75000000 &  0.70833333 &  0.69702381 &  0.69412185 &  0.69339120 \\
 0.69444444 &  0.69325397 &  0.69315453 &  0.69314765 & ~ \\
 0.69317460 &  0.69314790 &  0.69314719 & ~ & ~ \\
 0.69314748 &  0.69314718 & ~ & ~ & ~ \\
 0.69314718 & ~ & ~ & ~ & ~ \\
\end{matrix}
$$

### 思考题

**（2）** 在实验 1 中二分次数和精度的关系如何？

根据 T 数表可知：二分次数越多所求的精度越高。需要的精度越高，所需的二分次数越多。龙贝格积分的算法中停止条件由输入的精度 $\epsilon$ 决定。
