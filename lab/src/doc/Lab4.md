# 牛顿(Newton)迭代法

## 问题分析

### 实验要求

编写代码实现牛顿(Newton)迭代法的算法，用计算机求非线性方程的数值解。

### 算法背景

牛顿迭代法属于求非线性方程数值解方法中的单点迭代法。相比于不动点的迭代法，牛顿迭代法的收敛速度一般更快。牛顿迭代法可看作基于反函数 Taylor 展开到二阶项的迭代法构造。牛顿迭代法是局部收敛的方法，当初值的选取充分接近根是一般可保证迭代收敛，其中在单根附近二阶收敛，在重根附近线性收敛。

### 算法特点

一般来说收敛速度较快，重根附近为线性收敛。若遇到重根，可采用重根上的迭代法确保二阶收敛的速度。

### 待求解问题

给定初值与精度要求，求 $f(x) = 0$ 的根。

## 数学原理

求非线性方程 $f(x)=0$ 的根 $x^*$，牛顿分析法计算公式：

$$
x_0 = \alpha , \ x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}, \ n = 0,1,\cdots
$$

一般地，牛顿迭代法具有局部收敛性，为了保证迭代收敛，要求，对充分小的 $\delta, \alpha \in O(x^*,\delta)$。如果 $f(x) \in C^2[a,b],f(x^*) = 0, f'(x^*) \ne 0$，那么，对充分小的 $\delta > 0$，当 $\alpha \in O(x^*, \delta)$ 时，由牛顿迭代法计算出的 $\{x_n\}$ 收敛于 $x^*$，且收敛速度是 2 阶的；如果 $f(x) \in C^m[a,b],f(x^*) = f'(x^*)=\cdots =f^{(m-1)}(x^*)=0$，$f^{(m)}(x^*)\ne 0 (m > 1)$，那么，对充分小的 $\delta > 0$，当$\alpha \in O(x^*,\delta)$时，由牛顿迭代法计算出的$\{x_n\}$收敛于$x^*$，且收敛速度是 1 阶的。


## 程序设计流程

```python
# 迭代式函数
def Iterated_function(
        f_in: Add,
        x: Symbol
) -> tuple:
    df_in = sympy.diff(f_in, x)
    return (sympy.lambdify(x, f_in, 'math'),
            sympy.lambdify(x, df_in, 'math'),
            sympy.lambdify(x, x-f_in/df_in, 'math'))

# 牛顿迭代法生成器
def Newtons_generator(
        fset: tuple[ufunc, ufunc, ufunc],
        x: Symbol
) -> Iterator:
    '''生成器函数，返回迭代器'''
    f, df, iterf = fset
    k = 0
    yield (k, x, abs(f(x)), abs(df(x)), math.nan)
    while True:
        xp = x
        x = iterf(x)
        k += 1
        yield (k, x, abs(f(x)), abs(df(x)), abs(x-xp))

# 牛顿迭代法过程
def Newton_method(
        f_in,
        epsilon_1: float,
        epsilon_2: float,
        N: int, x_0: float
) -> tuple[Optional[float], pandas.DataFrame]:
    x = sympy.symbols("x")
    table = pandas.DataFrame(columns=['k', 'x', 'F', 'DF', 'Tol'])
    fset = Iterated_function(f_in, x)
    niterator = Newtons_generator(fset, x_0)
    for k, x, F, DF, Tol in niterator:
        table.loc[k] = [k, x, F, DF, Tol]
        if(F < epsilon_1 or Tol < epsilon_1):
            return (x, table)
        if(DF < epsilon_2 or k >= N):
            return (None, table)
```

## 问题求解

$k$ 为迭代次数，$F=f(x)$，$DF=f^\prime(x)$，$Tol=x-x_{pre}$


#### (1)
$$
\cos x-x=0, \epsilon_1=10^{-6}, \epsilon_2=10^{-4}, N=10, x_0=\frac{\pi}{4}
$$

result = 0.73908518
table:

| k   | x        | F            | DF       | Tol      |
| --- | -------- | ------------ | -------- | -------- |
| 0   | 0.785398 | 7.829138e-02 | 1.707107 | NaN      |
| 1   | 0.739536 | 7.548747e-04 | 1.673945 | 0.045862 |
| 2   | 0.739085 | 7.512987e-08 | 1.673612 | 0.000451 |

#### (2)
$$
e^{-x}-\sin x=0, \epsilon_1=10^{-6}, \epsilon_2=10^{-4}, N=10, x_0=0.6
$$

result = 0.58853274
table:

| k   | x        | F            | DF       | Tol      |
| --- | -------- | ------------ | -------- | -------- |
| 0   | 0.600000 | 1.583084e-02 | 1.374147 | NaN      |
| 1   | 0.588480 | 7.381916e-05 | 1.386956 | 0.011520 |
| 2   | 0.588533 | 1.572578e-09 | 1.386897 | 0.000053 |

#### (1)
$$
x-e^{-x}=0, \epsilon_1=10^{-6}, \epsilon_2=10^{-4}, N=10, x_0=0.5
$$

result = 0.56714317
table:

| k   | x        | F            | DF       | Tol      |
| --- | -------- | ------------ | -------- | -------- |
| 0   | 0.500000 | 1.065307e-01 | 1.606531 | NaN      |
| 1   | 0.566311 | 1.304510e-03 | 1.567616 | 0.066311 |
| 2   | 0.567143 | 1.964805e-07 | 1.567143 | 0.000832 |

#### (2)
$$
x^2-2xe^{-x}+e^{-2x}=0, \epsilon_1=10^{-6}, \epsilon_2=10^{-4}, N=10, x_0=0.5
$$

result = 0.56660570
table:

| k   | x        | F            | DF       | Tol      |
| --- | -------- | ------------ | -------- | -------- |
| 0   | 0.500000 | 1.134878e-02 | 0.342290 | NaN      |
| 1   | 0.533156 | 2.872430e-03 | 0.170084 | 0.033156 |
| 2   | 0.550044 | 7.225737e-04 | 0.084778 | 0.016888 |
| 3   | 0.558567 | 1.812056e-04 | 0.042323 | 0.008523 |
| 4   | 0.562848 | 4.537189e-05 | 0.021145 | 0.004281 |
| 5   | 0.564994 | 1.135180e-05 | 0.010568 | 0.002146 |
| 6   | 0.566068 | 2.839055e-06 | 0.005283 | 0.001074 |
| 7   | 0.566606 | 7.099018e-07 | 0.002641 | 0.000537 |

### 思考题

**（1）** 对实验 1 确定初值的原则是什么？实际计算中应如何解决？

原则为接近根，这是因为牛顿迭代法的局部收敛性，当初值的选取充分接近根时牛顿迭代法一般可保证迭代收敛。在实验 1 中初值的选取逻辑应为：

$f(x)=\cos x-x$，有 $f(0)f(\frac{\pi}{2})<0$，且在区间上连续，取区间中点即 $x=\frac{\pi}{4}$ 为初值。

$f(x)=e^{-x} - \sin x$，有 $f(0)f(1.2)<0$，且在区间上连续，取区间中点即 $x=0.6$ 为初值。

实际计算中亦可采取这样的策略，但要注意区间尽量取小。若区间较大可以将区间等分，分别计算函数值后缩小区间的策略。即为了保证牛顿迭代法的收敛性可考虑先使用二分法（或称 n 分法）缩小区间。

**（2）** 对实验 2 如何解释在计算中出现的现象？试加以说明

可以发现本实验中例 1 与例 2 的函数存在平方关系，事实上，例 1 中所求的根为单根，例 2 中所求的根为二重根，于是尽管两个问题实际为同一个，所求的根也为同一个，但牛顿迭代法在单根附近二阶收敛，在二重根附近线性收敛，故在例 2 中收敛较慢。可以使用重根上的迭代法处理例 2 后进行迭代求解以解决收敛速度慢的问题。
